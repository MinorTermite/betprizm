name: ğŸ”„ Auto Update Matches Data

on:
  schedule:
    # Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ñ‡Ğ°ÑĞ¾Ğ²: 00:00, 05:00, 10:00, 15:00, 20:00 UTC
    - cron: '0 */5 * * *'
  workflow_dispatch:  # Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ

jobs:
  update-matches:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3
        
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 lxml
          
      - name: ğŸ” Run parser
        run: |
          python marathon_parser_improved.py
          
      - name: ğŸ“Š Check if data changed
        id: check_changes
        run: |
          if [[ -n $(git status -s matches.json) ]]; then
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"
          else
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "â„¹ï¸ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ½ĞµÑ‚"
          fi
          
      - name: ğŸ’¾ Commit and push if changed
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add matches.json
          git commit -m "ğŸ”„ ĞĞ²Ñ‚Ğ¾Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ°Ñ‚Ñ‡ĞµĞ¹ [$(date +'%Y-%m-%d %H:%M:%S')]"
          git push
          
      - name: ğŸ“ Create log entry
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          echo "[$(date +'%Y-%m-%d %H:%M:%S')] âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹" >> update_log.txt
          git add update_log.txt
          git commit -m "ğŸ“ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ»Ğ¾Ğ³"
          git push
